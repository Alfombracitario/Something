<!DOCTYPE html><html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Juego Terminal RPG</title>
    <style>
        /* VARIABLES PERSONALIZABLES */
        :root {
            --terminal-bg: #000;
            --terminal-text: #0f0;
            --terminal-aspect: 4/3;
            --button-bg: #333;
            --button-active: #555;
            --button-text: #fff;
            --button-size: 64px;
            --button-gap: 8px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: manipulation; user-select: none; }
        body {
            background: #111;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            padding: 10px;
        }
        #game-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            gap: 15px;
        }
        #terminal {
            background: var(--terminal-bg);
            color: var(--terminal-text);
            font-size: 12px;
            line-height: 1.4;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 8px;
            flex: 1;
            overflow: hidden;
            position: relative;
            aspect-ratio: var(--terminal-aspect);
            min-height: 0;
        }
        #terminal-content {
            white-space: pre-wrap;
            word-break: break-word;
            height: 100%;
            overflow: auto;
            display: block;
        }
        #controls {
            padding: 5px 0 15px;
        }
        .button-row {
            display: flex;
            justify-content: center;
            gap: var(--button-gap);
            margin-bottom: var(--button-gap);
        }
        .button-cell {
            flex: 1;
            display: flex;
            justify-content: center;
            max-width: calc(var(--button-size) * 1.5);
        }
        .btn {
            width: var(--button-size);
            height: var(--button-size);
            border-radius: 50%;
            background: var(--button-bg);
            color: var(--button-text);
            border: 2px solid #000;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
        }
        .btn:active {
            background: var(--button-active);
            transform: translateY(4px);
            box-shadow: 0 1px 0 rgba(0,0,0,0.3);
        }
        #btn-up::after    { content: "↑"; }
        #btn-down::after  { content: "↓"; }
        #btn-left::after  { content: "←"; }
        #btn-right::after { content: "→"; }
        #btn-a::after     { content: "A"; }
        #btn-b::after     { content: "B"; }
        #btn-1::after     { content: "1"; }
        #btn-2::after     { content: "2"; }
        #btn-select::after{ content: "SEL"; font-size: 16px; }
        #btn-start::after { content: "STA"; font-size: 16px; }
    </style>
</head>
<body>
    <div id="game-container"><div id="terminal">
        <div id="terminal-content">El juego no ha sido cargado aún</div>
    </div>
    
    <div id="controls">
        <!-- Tus controles aquí -->
        <div class="button-row">
            <div class="button-cell"><button class="btn" id="btn-1"></button></div>
            <div class="button-cell"><button class="btn" id="btn-up"></button></div>
            <div class="button-cell"><button class="btn" id="btn-2"></button></div>
        </div>
        <div class="button-row">
            <div class="button-cell"><button class="btn" id="btn-left"></button></div>
            <div class="button-cell"><button class="btn" id="btn-select"></button></div>
            <div class="button-cell"><button class="btn" id="btn-right"></button></div>
        </div>
        <div class="button-row">
            <div class="button-cell"><button class="btn" id="btn-a"></button></div>
            <div class="button-cell"><button class="btn" id="btn-down"></button></div>
            <div class="button-cell"><button class="btn" id="btn-b"></button></div>
        </div>
        <div class="button-row">
            <div class="button-cell"></div>
            <div class="button-cell"><button class="btn" id="btn-start"></button></div>
            <div class="button-cell"></div>
        </div>
    </div>
</div>

<script>
// FREAKIN' TEXT RPG 2!!!
// Sistema de escenas modular (state machine) para JS - funciones unificadas en cada escena

document.addEventListener('DOMContentLoaded', () => {
  // ——— Terminal ———
  const termEl = document.getElementById('terminal-content');
  function printf(text) {
    termEl.textContent += text;
    termEl.scrollTop = termEl.scrollHeight;
  }
  function clearScreen() {
    termEl.textContent = '';
  }

  // ——— Variables globales de juego ———
  let hp = 10, level = 1, xp = 0, xpNeed = 100, money = 0, mp = 0;
  let inventory = [{ name: "nothing", damage: 0, price: 0 }];
  let invCount = 1;
  let place = 0;

  // Constantes de lugares
  const PLACE_FOREST = 0;

  // ——— Input Handling ———
  let lastInput = null, previousKey = null;
  const keyMap = { ArrowUp:'U', ArrowDown:'D', ArrowLeft:'L', ArrowRight:'R', Enter:'+', ' ':'-', z:'A', x:'B', s:'1', a:'2' };
  document.addEventListener('keydown', e => {
    const code = keyMap[e.key];
    if (code && code !== previousKey) { lastInput = code; previousKey = code; }
  });
  document.addEventListener('keyup', e => {
    const code = keyMap[e.key]; if (code === previousKey) previousKey = null;
  });
  const btnMap = { 'btn-up':'U','btn-down':'D','btn-left':'L','btn-right':'R','btn-start':'+','btn-select':'-','btn-a':'A','btn-b':'B','btn-1':'1','btn-2':'2' };
  Object.entries(btnMap).forEach(([id, code]) => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('click', () => {
      if (code !== previousKey) {
        lastInput = code;
        previousKey = code;
        setTimeout(() => previousKey = null, 100);
      }
    });
  });

  // ——— Función auxiliar: formatea lista en columnas con flecha en índice ———
  function formatList(items, sel, cols) {
    // Sistema column-first: llena columnas antes de filas.
    const rows = Math.ceil(items.length / cols);
    let output = '';
    for (let r = 0; r < rows; r++) {
      let line = '';
      for (let c = 0; c < cols; c++) {
        const idx = r + c * rows;
        if (idx < items.length) {
          const prefix = (idx === sel) ? '> ' : '  ';
          let txt = items[idx];
          while (txt.length < 8) txt += ' ';
          line += prefix + txt;
        }
      }
      output += line.trimEnd() + '\n';
    }
    return output;
  }

  // ——— Sistema de escenas ———
  const scenes = {
    intro: {
      enter() {
        clearScreen();
        printf("FREAKIN' TEXT RPG 2!!! | Alfombracitarioj\n\n");
        printf("Long ago, there were knights, wizards, witches, and legends — tales of monsters lurking in the dark...\n\n");
        printf("The knights, driven by glory and honor, held back the darkness for a time. But as the centuries passed, the legends faded. The monsters, however, remained — hiding in plain sight, their faces changed, their presence ignored.\n\n");
        printf("Now, you, the last knight, have seen the truth. And whether it is madness or destiny, you know your purpose: take up the mantle, write your own legend, and stand against the shadows that still haunt this world.\n\n");
        printf("-[Press any key to start]\n");
      },
      update(input) {
        if (input) {
          currentScene = scenes.menu;
          currentScene.enter();
        }
      }
    },

    menu: {
      selected: 0,
      options: ["Inv","Explore","Stats","Rest"],
      cols: 2,
      enter() {
        this.selected = 0;
        this.render();
      },
      update(input) {
        const n = this.options.length;
        if (input === 'L') this.selected = (this.selected + this.cols) % n;
        if (input === 'R') this.selected = (this.selected - this.cols + n) % n;
        if (input === 'U' && this.selected % this.cols === 1) this.selected--;
        if (input === 'D' && this.selected % this.cols === 0 && this.selected + 1 < n) this.selected++;
        if (input === 'A' || input === '2') {
          switch (this.selected) {
            case 0: currentScene = scenes.inventory; break;
            case 1: currentScene = scenes.explore; break;
            case 2: currentScene = scenes.stats; break;
            case 3: currentScene = scenes.rest; break;
          }
          currentScene.enter();
          return;
        }
        this.render();
      },
      render() {
        clearScreen();
        printf("FREAKIN' TEXT RPG 2!!! | Alfombracitarioj\n\n");
        printf(formatList(this.options, this.selected, this.cols));
      }
    },

    inventory: {
      enter() {
        clearScreen();
        printf("[Inventory]\n");
        for (let i = 0; i < invCount; i++) {
          printf("|" + inventory[i].name + "\n");
        }
      },
      update(input) {
        if (input === 'B') { currentScene = scenes.menu; currentScene.enter(); }
      }
    },

    stats: {
      enter() {
        clearScreen();
        printf("[Statistics]\n");
        printf(`|HP:${hp} MP:${mp}] [LV:${level} XP:${((xp/xpNeed)*100).toFixed(0)}%]\n`);
        printf(`[$:${money}]\n`);
      },
      update(input) {
        if (input === 'B') { currentScene = scenes.menu; currentScene.enter(); }
      }
    },

    explore: {
      enter() {
        clearScreen();
        switch (place) {
          case PLACE_FOREST:
            printf("You're in a forest, what you do now?\n");
            printf("- Explore more (A)\n");
            printf("- Back (B)\n");
            break;
        }
      },
      update(input) {
        if (input === 'B') { currentScene = scenes.menu; currentScene.enter(); }
      }
    },

    rest: {
      enter() {
        clearScreen();
        hp += 5;
        printf("You rest and recover some HP...\n");
        setTimeout(() => { currentScene = scenes.menu; currentScene.enter(); }, 1000);
      },
      update() {}
    }
  };

  // Estado inicial
  let currentScene = scenes.intro;
  currentScene.enter();

  // ——— Bucle de juego (16ms) ———
  setInterval(() => {
    if (lastInput) {
      currentScene.update(lastInput);
      lastInput = null;
    }
  }, 16);

  // ——— Función aleatoria ———
  function irng(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
});

</script>
</body>
</html>
